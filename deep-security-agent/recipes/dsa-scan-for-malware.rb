#
# Cookbook Name:: deep-security-agent
# Recipe:: Scan the node for malware
#
# Copyright 2015, Trend Micro
#
# License as per [repo](master/LICENSE)
#
# *********************************************************************
# * Scan the node for malware
# *********************************************************************

dsa_args = '-m "AntiMalwareManualScan:true"' # scan the node for malware

if node[:platform_family] =~ /win/
  powershell_script 'prompt_ds_agent' do
    code <<-EOH
    & $Env:ProgramFiles"\\Trend Micro\\Deep Security Agent\\dsa_control" #{dsa_args}
    EOH
  end
else
  execute 'prompt_ds_agent' do
    command "/opt/ds_agent/dsa_control #{dsa_args}"
  end
end
Chef::Log.info 'The Deep Security agent will check in with the manager shortly'
